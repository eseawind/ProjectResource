{"inframe":true,"title":"CRUD基本操作","hidden":false,"roles":{"demo":1},"children":[{"configs":{"itemId":"module"},"events":{"initialize":"Wb.apply(app, {\n  add: function() {\n    app.editTitleBar.setTitle('添加');\n    app.viewport1.setActiveItem(app.editPanel);\n    Wb.reset(app.editPanel);\n    Wb.resetScroll(app.editPanel);\n    app.isEdit = false;\n  },\n  edit: function() {\n    var r = app.list1.getSelection()[0];\n    if (!r) {\n      Wb.warn('请选择一条记录。');\n      return;\n    }\n    app.selRec = r;\n    app.editTitleBar.setTitle('修改 - ' + r.data.REAL_NAME);\n    app.viewport1.setActiveItem(app.editPanel);\n    Wb.setValue(app.editPanel, r.data);\n    app.isEdit = true;\n  },\n  remove: function() {\n    var sels = app.list1.getSelection();\n    Wb.confirmDo(sels, function() {\n      Wb.request({\n        url: 'm?xwl=examples/employee/dialog/delete',\n        params: {\n          destroy: Wb.getData(sels, true)\n        },\n        success: function() {\n          Wb.remove(app.list1, sels);\n        }\n      });\n    }, 'REAL_NAME');\n  },\n  refresh: function() {\n    app.store.load(); //不可使用app.store.reload，因为最后一次加载属于添加模式\n  },\n  searchCompany: function() {\n    app.companyStore.load({\n      params: {\n        query: app.searchCompanyText.getValue()\n      }\n    });\n  }\n});"},"children":[{"configs":{"menu":" [{\n   text: '添加',\n   glyph: 'f067',\n   handler: app.add\n }, {\n   text: '修改',\n   glyph: 'f044',\n   handler: app.edit\n }, {\n   text: '删除',\n   glyph: 'f00d',\n   handler: app.remove\n }, {\n   text: '刷新',\n   glyph: 'f021',\n   handler: app.refresh\n }]","itemId":"menu"},"children":[],"expanded":false,"type":"tpanel"},{"configs":{"layout":"card","itemId":"viewport1"},"children":[{"configs":{"layout":"fit","itemId":"container1"},"children":[{"configs":{"title":"员工管理","docked":"top","itemId":"toolbar"},"children":[{"configs":{"align":"right","glyph":"f0c9","itemId":"menuBtn"},"events":{"tap":"app.menu.showBy(button);"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"ttitlebar"},{"configs":{"itemTpl":"{REAL_NAME} ({EMPLOYEE_CODE})","autoPaging":"true","itemId":"list1"},"events":{"itemdoubletap":"app.edit();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=apps/sys/demo/crud/basic/select"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"},{"configs":{"scrollable":"true","itemId":"editPanel"},"events":{"action":"app.okBtn.fireEvent('tap');"},"children":[{"configs":{"docked":"top","itemId":"editTitleBar"},"children":[{"configs":{"text":"取消","align":"left","itemId":"cancelBtn"},"events":{"tap":"app.viewport1.setActiveItem(app.container1);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"text":"确定","align":"right","itemId":"okBtn"},"events":{"tap":"if (!Wb.verify(app.editPanel))\n  return;\nvar values = Wb.getValue(app.editPanel);\nif (app.isEdit) {\n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/employee/dialog/update',\n    params: Wb.applyIf(values, Wb.getData(app.selRec, true)), //合并窗口和记录数据作为参数，后者为默认值\n    success: function() {\n      //把窗口数据更新到选择记录中\n      Wb.update(app.selRec, values);\n      //返回到数据列表\n      app.viewport1.setActiveItem(app.container1);\n    }\n  });\n} else {\n  //点击添加按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/employee/dialog/insert',\n    params: values,\n    success: function(resp) {\n      //把服务器返回的数据合并窗口数据（公司名称等数据）添加到list中\n      Wb.add(app.list1, Wb.apply(Wb.decode(resp.responseText), values), 'first');\n      //返回到数据列表\n      app.viewport1.setActiveItem(app.container1);\n    }\n  });\n}"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"ttitlebar"},{"configs":{"itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"{\n  remark: '该控件可以使用tnlist树形控件替代，在新card中以树形显示部门结构'\n}","displayField":"DEPT_NAME","valueField":"DEPT_ID","label":"部门","itemId":"DEPT_ID","required":"true"},"children":[{"configs":{"itemId":"store","normalName":"companyStore","autoLoad":"true","url":"m?xwl=apps/sys/demo/crud/basic/select-dept"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tselect"},{"configs":{"label":"员工编号","itemId":"EMPLOYEE_CODE","required":"true"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"label":"姓名","itemId":"REAL_NAME","required":"true"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"label":"出生日期","itemId":"BIRTH_DATE","required":"true"},"children":[],"expanded":false,"type":"tdate"},{"configs":{"keyName":"sex","label":"性别","itemId":"SEX","required":"true"},"children":[],"expanded":false,"type":"tselect"},{"configs":{"keyName":"nation","label":"民族","itemId":"NATION"},"children":[],"expanded":false,"type":"tselect"},{"configs":{"xtype":"emailfield","label":"电子邮件","itemId":"EMAIL"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"label":"负责公司","itemId":"COMPANY_NAME"},"events":{"focus":"//基于良好的用户体验，可以使用HTML5定制公司选择器（可以参照大部分app的地名选择设计），此例作为演示使用list控件替代。\ntext.blur();\napp.viewport1.setActiveItem(app.companySelector);"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"decimalPrecision":"0","minValue":"0","label":"休假时长","itemId":"VACATION_HOURS"},"children":[],"expanded":false,"type":"tnumber"},{"configs":{"itemId":"COMPANY_ID"},"children":[],"expanded":false,"type":"thidden"},{"configs":{"xtype":"textareafield","label":"备注","itemId":"REMARK"},"children":[],"expanded":false,"type":"ttext"}],"expanded":true,"type":"tfieldset"}],"expanded":true,"type":"tcontainer"},{"configs":{"layout":"fit","itemId":"companySelector"},"children":[{"configs":{"docked":"top","layout":"hbox","itemId":"toolbar1"},"children":[{"configs":{"align":"left","glyph":"f053","itemId":"backBtn"},"events":{"tap":"app.viewport1.setActiveItem(app.editPanel);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"placeHolder":"公司名称","itemId":"searchCompanyText","flex":"1"},"events":{"keyup":"//paste亦触发该事件\napp.searchCompany();"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"align":"right","glyph":"f002","itemId":"searchBtn"},"events":{"tap":"app.searchCompany();"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"ttoolbar"},{"configs":{"itemTpl":"{COMPANY_NAME}","itemId":"companyList"},"events":{"select":"Wb.setValue(app.editPanel, record.data);\napp.viewport1.setActiveItem(app.editPanel);"},"children":[{"configs":{"itemId":"store","normalName":"companyStore","autoLoad":"true","url":"m?xwl=examples/employee/edit/company-list"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}