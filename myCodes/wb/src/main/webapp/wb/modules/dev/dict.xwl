{"inframe":false,"title":"数据字典","hidden":false,"roles":{"demo":1},"children":[{"configs":{"serverMethod":"com.wb.interact.Tools.loadKeyNames","itemId":"module"},"events":{"initialize":"Wb.apply(app, {\n  reloadFields: function(win) {\n    var items = [],\n      existFields = {};\n    app.gridStore.each(function(item) {\n      existFields[item.data.FIELD_NAME] = true;\n    });\n    Wb.each(app.fieldNameList, function(item) {\n      if (!existFields[item.name])\n        items.push(item);\n    });\n    win.down('#FIELD_NAME').store.loadData(items);\n  }\n});"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"new Ext.KeyNav({\n  viewport: app.viewport1,\n  E: {\n    ctrl: true,\n    fn: function() {\n      if (!app.newBtn.disabled)\n        app.newBtn.fireEvent('click');\n    }\n  }\n});"},"children":[{"configs":{"rootVisible":"false","region":"west","title":"数据库列表","plugins":"{ptype:'bufferedrenderer'}","collapsible":"true","width":"200","split":"true","itemId":"tableTree","iconCls":"db_icon"},"events":{"afterrender":"Wb.setNavigate(tree, app.backBtn, app.forwardBtn);","selectionchange":"var tableName, upperTableName, dbName, grid = app.grid1,\n  rec = selected[0];\nif (rec && rec.isLeaf()) {\n  if (grid.disabled)\n    grid.setDisabled(false);\n  dbName = rec.parentNode.data.text;\n  tableName = (dbName == 'default' ? '' : dbName + '.') + rec.data.table; //表名不带schem，如果非默认数据库则带jndi变量名前缀\n  upperTableName = tableName.toUpperCase();\n  grid.tableName = upperTableName;\n  Wb.setTitle(grid, tableName);\n  grid.store.load({\n    params: {\n      schemTableName: rec.data.text,\n      jndi: rec.parentNode.data.jndi,\n      TABLE_NAME: upperTableName\n    }\n  });\n}"},"children":[{"configs":{"params":"{hasSchem:'{#Var.sys.db.tableSchemPrefix#}'=='true'}","itemId":"store","url":"m?xwl=dev/dict/get-tree","fields":"['text', 'jndi', 'schem', 'table']"},"events":{"beforeload":"operation.params.jndi = operation.node.data.jndi;\noperation.params.dbName = operation.node.data.text;"},"children":[],"expanded":false,"type":"treestore"},{"configs":{"itemId":"tools"},"children":[{"configs":{"tooltype":"refresh","itemId":"refreshBtn","tooltip":"刷新"},"events":{"click":"Wb.reload(app.tableTree);"},"children":[],"expanded":false,"type":"item"},{"configs":{"tooltype":"gear","itemId":"setBtn","tooltip":"切换表名前Schem"},"events":{"click":"app.tableTree.store.params.hasSchem = !app.tableTree.store.params.hasSchem;\nvar hasSchem = app.tableTree.store.params.hasSchem;\nExt.suspendLayouts();\napp.tableTree.getRootNode().cascadeBy(function(node) {\n  if (node.isLeaf()) {\n    node.set('text', hasSchem && !Wb.isEmpty(node.data.schem) ?\n      (node.data.schem + '.' + node.data.table) : node.data.table);\n    node.commit();\n  }\n});\nExt.resumeLayouts(true);"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"array"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","title":"字段字典定义","multiSelect":"true","itemId":"grid1","iconCls":"book_icon","disabled":"true"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"region":"north","enableOverflow":"true","itemId":"tbar"},"children":[{"configs":{"text":"添加","itemId":"newBtn","iconCls":"record_add_icon","tooltip":"添加新的记录 (Ctrl+E)"},"events":{"click":"var win, tableName = app.grid1.tableName;\nwin = Wb.insert(app.grid1, {\n  title: '添加 - ' + tableName,\n  url: 'm?xwl=dev/dict/insert',\n  windowName: 'sys.dev.dict.editWin', //单例模式，关闭时隐藏\n  destroyOn: app.viewport1, //在viewport1销毁时销毁该窗口\n  resetScrollbar: true,\n  params: {\n    TABLE_NAME: tableName\n  }\n});\napp.reloadFields(win);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"修改","itemId":"editBtn","iconCls":"record_edit_icon","tooltip":"修改选择的记录"},"events":{"click":"var win = Wb.edit(app.grid1, {\n  url: 'm?xwl=dev/dict/update',\n  titleField: 'FIELD_NAME',\n  focusControl: null, //修改时不要设置焦点，方便还原上次状态\n  windowName: 'sys.dev.dict.editWin', //单例模式，关闭时隐藏\n  destroyOn: app.viewport1, //在viewport1销毁时销毁该窗口\n  params: {\n    TABLE_NAME: app.grid1.tableName\n  }\n});\nif (win)\n  app.reloadFields(win);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"删除","itemId":"delBtn","iconCls":"record_delete_icon","tooltip":"删除选择的记录"},"events":{"click":"Wb.del(app.grid1, {\n  url: 'm?xwl=dev/dict/delete',\n  titleField: 'FIELD_NAME'\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"返回","itemId":"backBtn","iconCls":"left_icon","tooltip":"转到上一个页面"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"前进","itemId":"forwardBtn","iconCls":"right_icon","tooltip":"转到后退前的页面"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","sorters":"'FIELD_NAME'","itemId":"store","normalName":"gridStore","url":"m?xwl=dev/dict/select"},"events":{"success":"var col, grid = app.grid1;\napp.fieldNameList = Wb.getTag(grid, 'tableFields');\nWb.each(app.fieldNameList, function(item) {\n  item.name = item.name.toUpperCase();\n});\nif (!grid.colsLoaded) {\n  col = Wb.getColumn(grid, 'FIELD_NAME');\n  col.editor = {\n    xtype: 'combo',\n    allowBlank: false,\n    queryMode: 'local',\n    displayField: 'name',\n    fieldStyle: 'text-transform:uppercase', //强制大写，避免不同数据库之间的差异\n    getValue: function() { //重载getValue使其取值大写\n      var val = Ext.form.field.ComboBox.prototype.getValue.apply(this);\n      return val ? val.toUpperCase() : val;\n    },\n    store: {\n      fields: ['name']\n    }\n  };\n  col = Wb.getColumn(grid, 'KEY_NAME');\n  col.editor = {\n    xtype: 'combo',\n    // forceSelection: true,\n    store: Wb.decode(\"{#keyNameList#}\")\n  };\n  grid.colsLoaded = true;\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"book_icon"}