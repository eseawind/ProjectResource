{"inframe":false,"title":"SQL 生成器","hidden":false,"roles":{},"children":[{"configs":{"itemId":"sys.util.sqlBuilder"},"events":{"initialize":"//私有方法\nfunction createSQL() {\n  var node = app.tableTree.getSelection()[0];\n  if (!node || !node.isLeaf())\n    return;\n  var params = [];\n  app.toolbar1.items.each(function(btn) {\n    if (btn.pressed)\n      params.push(btn.itemId.slice(0, -3));\n  });\n  Wb.request({\n    url: 'm?xwl=dev/ide/sql-builder/create-clause',\n    mask: app.sqlPanel,\n    params: {\n      sql: params[0],\n      type: params[1],\n      jndi: node.parentNode.data.jndi,\n      table: node.data.text,\n      prefix: app.prefixText.getValue()\n    },\n    success: function(resp) {\n      app.editor.setValue(resp.responseText);\n    }\n  });\n}\n\nfunction showWin() {\n  function doShow() {\n    var sqlWin;\n\n    //单例模式\n    if (Wb.hasNS('sys.util.sqlBuilder.winInstance'))\n      sqlWin = sys.util.sqlBuilder.winInstance;\n    else {\n      sqlWin = new Ext.window.Window(app.win);\n      app.winInstance = sqlWin;\n    }\n    sqlWin.show();\n  }\n  if (window.CodeMirror)\n    doShow();\n  else {\n    Wb.addLink(['wb/libs/cm/cmirror.css', 'wb/libs/cm/cmirror.js'],\n      doShow\n    );\n  }\n}\n\n//公有方法，可通过app.method来访问\nWb.apply(app, {\n  /**\n   * @param {Function} [callback] 点击确定按钮后执行的方法，传递参数为编辑器SQL。\n   */\n  getSQL: function(callback) {\n    app.callback = callback;\n    showWin();\n  }\n});"},"children":[{"configs":{"width":"800","closeAction":"hide","itemId":"win","iconCls":"sql_icon","createInstance":"false","autoShow":"true","title":"SQL生成器","height":"450","layout":"border","resizable":"true","dialog":"true","modal":"true","maximizable":"true"},"events":{"afterrender":"app.toolbar1.items.each(function(btn) {\n  if (btn.itemId != 'sp') {\n    btn.allowDepress = false;\n    btn.mon(btn, 'toggle', createSQL);\n  }\n});","ok":"app.callback(app.editor.getValue());\nwin.close();"},"children":[{"configs":{"region":"north","weight":"80","itemId":"toolbar1"},"children":[{"configs":{"text":"select","pressed":"true","toggleGroup":"sql","itemId":"selectBtn","tooltip":"显示select语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"insert","toggleGroup":"sql","itemId":"insertBtn","tooltip":"显示insert语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"update","toggleGroup":"sql","itemId":"updateBtn","tooltip":"显示update语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"delete","toggleGroup":"sql","itemId":"deleteBtn","tooltip":"显示delete语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","toggleGroup":"sql","itemId":"sp"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"原生","toggleGroup":"type","itemId":"nativeBtn","tooltip":"显示原生语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"参数","pressed":"true","toggleGroup":"type","itemId":"paramsBtn","tooltip":"显示参数宏语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"替换","toggleGroup":"type","itemId":"replaceBtn","tooltip":"显示替换宏语句"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","toggleGroup":"sql","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"width":"150","emptyText":"select 表名前缀","itemId":"prefixText"},"events":{"change":"createSQL();"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"},{"configs":{"rootVisible":"false","region":"west","title":"数据库列表","collapsible":"true","plugins":"{ptype:'bufferedrenderer'}","width":"200","split":"true","itemId":"tableTree","iconCls":"db_icon"},"events":{"selectionchange":"createSQL();"},"children":[{"configs":{"params":"{hasSchem:'{#Var.sys.db.tableSchemPrefix#}'=='true'}","itemId":"store","url":"m?xwl=dev/ide/sql-builder/get-tree","fields":"['text', 'jndi', 'schem', 'table']"},"events":{"beforeload":"operation.params.jndi = operation.node.data.jndi;"},"children":[],"expanded":false,"type":"treestore"},{"configs":{"itemId":"tools"},"children":[{"configs":{"tooltype":"refresh","itemId":"refreshBtn","tooltip":"刷新"},"events":{"click":"Wb.reload(app.tableTree);"},"children":[],"expanded":false,"type":"item"},{"configs":{"tooltype":"gear","itemId":"setBtn","tooltip":"切换表名前Schem"},"events":{"click":"app.tableTree.store.params.hasSchem = !app.tableTree.store.params.hasSchem;\nvar hasSchem = app.tableTree.store.params.hasSchem;\nExt.suspendLayouts();\napp.tableTree.getRootNode().cascadeBy(function(node) {\n  if (node.isLeaf()) {\n    node.set('text', hasSchem && !Wb.isEmpty(node.data.schem) ?\n      (node.data.schem + '.' + node.data.table) : node.data.table);\n    node.commit();\n  }\n});\nExt.resumeLayouts(true);"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"array"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","html":"<textarea><\/textarea>","itemId":"sqlPanel"},"events":{"afterrender":"panel.editor = CodeMirror.fromTextArea(panel.el.down('textarea', true), {\n  mode: 'text/x-sql',\n  lineWrapping: true,\n  matchBrackets: true\n});\napp.editor = panel.editor;","resize":"if (panel.editor && !panel.destroying) {\n  Ext.fly(panel.editor.getScrollerElement()).setHeight(height);\n  panel.editor.refresh();\n}"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}