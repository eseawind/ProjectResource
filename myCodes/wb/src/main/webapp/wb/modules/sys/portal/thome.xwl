{"inframe":true,"title":"移动主页","hidden":false,"roles":{"demo":1,"default":1,"basic":1},"children":[{"configs":{"title":"{#Var.sys.app.title#}","loginRequired":"false","serverMethod":"com.wb.interact.Portal.initTouchHome","itemId":"sys.thome"},"events":{"finalize":"Wb.setNavigate(app.container, app.backBtn, app.forwardBtn);\napp.computeIconWidth();\nif ('{#isNotLogin#}' == '1')\n  Wb.login(function(scope) {\n    if ('{#test#}' == '1') {\n      scope.notSetData = true;\n      scope.username.setValue('test');\n      scope.password.setValue('test');\n    }\n  }, function() {\n    app.toolbar.setHidden(false);\n    app.refreshApps();\n  });\nelse {\n  app.toolbar.setHidden(false);\n  app.refreshApps();\n}","initialize":"Wb.apply(app, {\n  /**\n   * 添加系统返回前进按钮的历史记录。\n   * @param {Mixed} param 参数。如果参数类型为字符串则指定为url，否则指定为控件，并以其id作为url。\n   */\n  addHistory: function(param) {\n    if (param) {\n      app.history.add({\n        url: Ext.isString(param) ? param : param.getId()\n      }, true);\n    }\n  },\n  /**\n   * 按系统返回前进按钮时触发的事件。用户可以重载此方法以自定义系统返回前进按钮功能。\n   * @param {String} param 用户使用addHistory添加的参数或添加的控件itemId。\n   */\n  setHistory: function(param) {\n    if (Ext.getBody().down('div[class~=x-mask]:not([class~=x-item-hidden])') || Wb.hasModalWin) {\n      //如果存在模态窗口禁止使用导航\n      app.disableSetHistory = true;\n      app.addHistory(app.container.getActiveItem());\n      return;\n    }\n    if (!param) {\n      if (app.container.getActiveItem() != app.appList)\n        app.container.setActiveItem(app.appList);\n      else\n        Wb.toast(Str.backToExit);\n      return;\n    }\n    var item = Ext.getCmp(param);\n    if (item)\n      app.container.setActiveItem(item);\n  },\n  computeIconWidth: function() {\n    var i, j, containerWidth = app.container.innerElement.getWidth() - 16,\n      minVal = containerWidth,\n      iconWidth = 80;\n    for (i = 80; i < 100; i++) {\n      j = containerWidth % i;\n      if (j < minVal) {\n        minVal = j;\n        iconWidth = i;\n      }\n    }\n    app.appIconWidth = iconWidth;\n  },\n  refreshApps: function() {\n    app.appList.store.load();\n  },\n  close: function() {\n    var item = app.container.getActiveItem();\n    //外部加载的模块\n    if (item.__url)\n      app.container.remove(item);\n  },\n  closeAll: function() {\n    app.container.items.each(function(item) {\n      if (item.__url)\n        app.container.remove(item);\n    });\n    if (app.container.getActiveItem() == app.winList)\n      app.reloadWins();\n  },\n  logout: function() {\n    Wb.request({\n      url: 'logout',\n      success: function(resp) {\n        Wb.login(app.closeAll, app.refreshApps);\n      }\n    });\n  },\n  reloadWins: function() {\n    var container = app.container,\n      wins = [];\n    container.items.each(function(item) {\n      if (item.__url) {\n        wins.push({\n          title: item.__title,\n          glyph: item.__glyph,\n          image: item.__image,\n          win: item\n        });\n      }\n    });\n    app.winList.store.applyData(wins);\n  }\n});\napp.history = new Ext.app.History({\n  listeners: {\n    change: function(url) {\n      if (app.disableSetHistory)\n        app.disableSetHistory = false;\n      else\n        app.setHistory(url);\n    }\n  }\n});"},"children":[{"configs":{"menu":" [{\n   text: Str.logout,\n   glyph: 'f011',\n   handler: app.logout\n }, {\n   text: Str.close,\n   glyph: 'f00d',\n   handler: app.close\n }, {\n   text: Str.closeAll,\n   glyph: 'f057',\n   handler: app.closeAll\n }, {\n   text: Str.refreshApps,\n   glyph: 'f021',\n   handler: app.refreshApps\n }]","width":"230","itemId":"mainMenu"},"children":[],"expanded":true,"type":"tpanel"},{"configs":{"layout":"fit","itemId":"viewport"},"children":[{"configs":{"layout":"card","itemId":"container"},"events":{"activeitemchange":"app.addHistory(value);"},"children":[{"configs":{"cls":"dataview-inline","style":"background-color:white;","itemTpl":"<table width='{[app.appIconWidth]}px' style='table-layout:fixed;color:#737373;'>\n  <tr><td align='center' valign='middle' style='height:60px;'><div class='wb_glyph4 x-dv-item-pad' style='width:48px;height:48px;background-size:cover;background-image:url({image});'>{glyph}<\/div><\/td><\/tr>\n  <tr><td align='center' valign='top' style='height:30px;'><div style='font-size:13px;'>{title}<\/div><\/td><\/tr>  \n<\/table>","inline":"true","padding":"8","itemId":"appList"},"events":{"itemtap":"var found, url = record.get('url');\n\napp.container.items.each(function(item) {\n  if (item.__url == url) {\n    found = true;\n    app.container.setActiveItem(item);\n    return;\n  }\n});\nif (found)\n  return;\nWb.run({\n  url: url,\n  success: function(scope) {\n    Wb.each(scope, function(k, v) {\n      if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n        var newCard = app.container.add({\n          xtype: 'container',\n          layout: 'fit'\n        });\n        newCard.add(v);\n        newCard.__glyph = record.get('glyph');\n        newCard.__image = record.get('image');\n        newCard.__title = record.get('title');\n        newCard.__url = url;\n        app.container.setActiveItem(newCard);\n        return false;\n      }\n    });\n  }\n});"},"children":[{"configs":{"maskBindObject":"true","itemId":"store","url":"m?xwl=sys/portal/thome/get-apps","fields":"['title', 'image', 'glyph', 'url']"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tdataview"},{"configs":{"cls":"dataview-inline","style":"background-color:white;","itemTpl":"<table width='{[app.appIconWidth]}px' style='table-layout:fixed;color:#737373;'>\n  <tr><td align='center' style='height:60px;'><div class='wb_glyph4' style='width:48px;height:48px;background-size:cover;background-image:url({image});'>{glyph}<\/div><\/td><\/tr>\n  <tr><td align='center' valign='top' style='height:30px;'><div style='font-size:13px;'>{title}<\/div><\/td><\/tr>  \n<\/table>","inline":"true","padding":"8","itemId":"winList"},"events":{"itemtap":"app.container.setActiveItem(record.get('win'));"},"children":[{"configs":{"autoLoad":"true","itemId":"store","fields":"['title', 'image', 'glyph', 'win']"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tdataview"},{"configs":{"docked":"bottom","hidden":"true","itemId":"toolbar"},"children":[{"configs":{"itemId":"spacer1"},"children":[],"expanded":false,"type":"tspacer"},{"configs":{"ui":"plain","glyph":"f060","itemId":"backBtn"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","glyph":"f061","itemId":"forwardBtn"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","glyph":"f0c9","itemId":"menuBtn"},"events":{"tap":"app.mainMenu.showBy(button);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","glyph":"f015","itemId":"homeBtn"},"events":{"tap":"app.container.setActiveItem(app.appList);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","glyph":"f17a","itemId":"winBtn"},"events":{"tap":"app.reloadWins();\napp.container.setActiveItem(app.winList);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"itemId":"spacer2"},"children":[],"expanded":false,"type":"tspacer"}],"expanded":true,"type":"ttoolbar"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}