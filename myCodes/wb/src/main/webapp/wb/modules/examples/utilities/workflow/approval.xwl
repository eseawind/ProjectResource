{"inframe":false,"title":"报销审批","hidden":false,"roles":{"demo":1},"children":[{"configs":{"description":"本示例仅用于演示目的，实际业务中审批角色可以同当前用户的职位直接关联。\n流程流转到[报销到账]节点时，在系统控制台显示当前用户报销到账的通知，实际业务中可以执行自动银行转账和邮件通知到账的操作。\n流程流转过程中的历史数据可以保存到单独的表中以作进一步处理。","itemId":"module"},"events":{"initialize":"app.approve = function(reject) {\n  var sels = app.grid1.getSelection();\n  if (!sels.length) {\n    Wb.warn('请选择至少一条记录。');\n    return;\n  }\n  var promptWin = Wb.promptText('审批' + (reject ? '拒绝' : '同意') + '意见 - ' + sels.length + ' 项', function(value, win) {\n    Wb.request({\n      url: 'm?xwl=examples/utilities/workflow/approval/approve',\n      out: app.grid1,\n      params: {\n        comment: value,\n        reject: reject\n      },\n      success: function(resp) {\n        Wb.remove(app.grid1); //移除已经审批的记录，可以根据需要把审批的数据在后台审批时另存到单独的历史数据表中。\n        win.close();\n      }\n    });\n  }, {\n    value: reject ? '拒绝' : '同意',\n    allowBlank: false\n  });\n  promptWin.down('#text').focus(true, true);\n};"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"toolbar1"},"children":[{"configs":{"text":"角色切换：","itemId":"roleLabel"},"children":[],"expanded":false,"type":"item"},{"configs":{"width":"300","itemId":"radiogroup1"},"events":{"change":"app.listStore.load();"},"children":[{"configs":{"itemId":"radio1","checked":"true","boxLabel":"部门经理审批"},"children":[],"expanded":false,"type":"radio"},{"configs":{"itemId":"radio2","boxLabel":"上级经理审批"},"children":[],"expanded":false,"type":"radio"},{"configs":{"itemId":"radio3","boxLabel":"财务审核处理"},"children":[],"expanded":false,"type":"radio"}],"expanded":true,"type":"radiogroup"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"同意","itemId":"approveBtn","iconCls":"ok_icon"},"events":{"click":"app.approve(false); //app.approve方法在module.initialize中定义"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"拒绝","itemId":"rejectBtn","iconCls":"cancel_icon"},"events":{"click":"app.approve(true); //app.approve方法在module.initialize中定义"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"region":"center","multiSelect":"true","itemId":"grid1"},"events":{"selectionchange":"var rec = selected[0];\nif (rec) {\n  Wb.request({\n    url: 'm?xwl=examples/utilities/workflow/fee-apply/select-items',\n    params: rec.data,\n    success: function(resp) {\n      Wb.setValue(app.applyGrid, Wb.decode(resp.responseText));\n    }\n  });\n} else\n  app.applyStore.removeAll();"},"children":[{"configs":{"sorters":"{property:'MODIFY_DATE',direction:'DESC'}","remoteSort":"true","normalName":"listStore","autoLoad":"true","itemId":"store","url":"m?xwl=examples/utilities/workflow/approval/select-list"},"events":{"beforeload":"operation.params = {\n  ACTIVE_NODE: app['radio' + (app.radiogroup1.getValue() + 1)].boxLabel\n};"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","multiSelect":"true","height":"200","submitSelect":"false","split":"true","itemId":"applyGrid","editable":"true"},"children":[{"configs":{"normalName":"applyStore","itemId":"store","fields":"['name', 'fee', 'remark']"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"name","itemId":"nameCol","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"金额","dataIndex":"fee","itemId":"feeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"备注","dataIndex":"remark","itemId":"remarkCol"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}