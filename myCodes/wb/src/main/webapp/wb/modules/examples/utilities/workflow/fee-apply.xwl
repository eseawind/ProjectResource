{"inframe":false,"title":"费用报销","hidden":false,"roles":{"demo":1},"children":[{"configs":{"itemId":"module"},"children":[{"configs":{"title":"报销申请","height":"400","width":"600","layout":"border","focusControl":"TITLE","resizable":"true","itemId":"applyWin","editWin":"true","maximizable":"true"},"events":{"ok":"if (app.applyStore.getCount() === 0) {\n  Wb.warn('报销费用项目明细不能为空。');\n  return;\n}\nif (Wb.verifyGrid(app.applyGrid)) {\n  if (app.isEdit) {\n    Wb.request({\n      url: 'm?xwl=examples/utilities/workflow/fee-apply/update-apply',\n      params: Wb.apply({}, Wb.getValue(app.applyWin), app.selRec.data),\n      success: function(resp) {\n        Wb.update(app.selRec, Wb.decode(resp.responseText));\n        app.applyWin.close();\n      }\n    });\n  } else {\n    Wb.request({\n      url: 'm?xwl=examples/utilities/workflow/fee-apply/create-apply',\n      out: app.applyWin,\n      success: function(resp) {\n        Wb.add(app.grid1, Wb.decode(resp.responseText), 'first');\n        app.applyWin.close();\n      }\n    });\n  }\n}"},"children":[{"configs":{"region":"north","layout":"hbox","margin":"8 8 0 8","itemId":"container1"},"children":[{"configs":{"text":"标题：","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"/** TITLE为流程支持的关键属性，因此使用大写 **/","allowBlank":"false","itemId":"TITLE","flex":"1"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"container"},{"configs":{"region":"north","layout":"hbox","margin":"8 8 0 8","itemId":"container11"},"children":[{"configs":{"text":"备注：","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"allowBlank":"false","itemId":"memo","flex":"1"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"container"},{"configs":{"region":"center","title":"报销费用项目明细","layout":"fit","margin":"8","itemId":"fieldset1","padding":"8"},"children":[{"configs":{"multiSelect":"true","pagingBar":"false","submitSelect":"false","itemId":"applyGrid","editable":"true"},"children":[{"configs":{"pageSize":"-1","itemId":"store","normalName":"applyStore","fields":"['name', 'fee', 'remark']"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"添加","itemId":"newBtn","iconCls":"record_add_icon","tooltip":"添加新的记录"},"events":{"click":"Wb.addEdit(app.applyGrid);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"删除","itemId":"delBtn","iconCls":"record_delete_icon","tooltip":"删除选择的记录"},"events":{"click":"Wb.remove(app.applyGrid);"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"name","itemId":"nameCol","flex":"1"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"金额","dataIndex":"fee","itemId":"feeCol"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"备注","dataIndex":"remark","itemId":"remarkCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"window"},{"configs":{"itemId":"window1"},"children":[],"expanded":false,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"toolbar1"},"children":[{"configs":{"text":"添加","itemId":"newBtn","iconCls":"record_add_icon","tooltip":"添加新的申请 (Ctrl+E)"},"events":{"click":"app.applyWin.setTitle('添加新的申请');\napp.applyWin.setIconCls('record_add_icon');\napp.applyStore.removeAll();\napp.applyStore.commitChanges();\napp.applyWin.show();\napp.isEdit = false;"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"修改","itemId":"editBtn","iconCls":"record_edit_icon","tooltip":"修改选择的记录"},"events":{"click":"var sels = app.grid1.getSelection();\nif (sels.length != 1) {\n  Wb.warn('请选择 1 条需要修改的记录。');\n  return;\n}\napp.selRec = sels[0];\napp.applyWin.setTitle('修改 - ' + app.selRec.data.TITLE);\napp.applyWin.setIconCls('record_edit_icon');\nWb.request({\n  url: 'm?xwl=examples/utilities/workflow/fee-apply/select-items',\n  params: app.selRec.data,\n  success: function(resp) {\n    Wb.setValue(app.applyWin, Wb.decode(resp.responseText));\n    app.applyWin.show();\n    app.isEdit = true;\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"删除","itemId":"delBtn","iconCls":"record_delete_icon","tooltip":"删除选择的记录"},"events":{"click":"var sels = app.grid1.getSelection();\nWb.confirmDo(sels, function() {\n  Wb.request({\n    url: 'm?xwl=examples/utilities/workflow/fee-apply/delete-apply',\n    params: {\n      destroy: Wb.getData(sels, true)\n    },\n    success: function() {\n      Wb.remove(app.grid1, sels);\n    }\n  });\n}, 'TITLE');"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"查看审批意见","itemId":"viewBtn","iconCls":"property_icon","tooltip":"查看当前申请的审批意见"},"events":{"click":"var rec = app.grid1.getSelection()[0];\nif (rec)\n  Wb.request({\n    url: 'm?xwl=examples/utilities/workflow/fee-apply/select-items',\n    params: rec.data,\n    success: function(resp) {\n      Wb.viewText('查看审批意见', Wb.decode(resp.responseText).comment);\n    }\n  });\nelse\n  Wb.warn('请选择一条记录。');"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"region":"center","multiSelect":"true","itemId":"grid1","loadColumns":"none"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"sorters":"{property:'MODIFY_DATE',direction:'DESC'}","remoteSort":"true","itemId":"store","autoLoad":"true","url":"m?xwl=examples/utilities/workflow/fee-apply/select-list"},"events":{"load":"if (!store.colsLoaded) {\n  var col = Wb.getColumn(store, 'MODIFY_DATE');\n  col.renderer = function(value, meta, record) {\n    var icon, status = record.get('STATUS');\n    switch (status) {\n      case '审批中':\n        icon = 'start_icon';\n        break;\n      case '拒绝':\n        icon = 'cancel_icon';\n        break;\n      case '完成':\n        icon = 'ok_icon';\n        break;\n    }\n    return Wb.getIcon(icon, status) + Wb.dateToText(value);\n  };\n  Wb.loadColumns(store);\n  store.colsLoaded = true;\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}