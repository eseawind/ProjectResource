{"title":"字典可编辑表格","inframe":false,"hidden":false,"roles":{"demo":1},"pageLink":"","children":[{"configs":{"itemId":"module"},"events":{"beforeunload":"if (app.isModified)\n  return '可编辑表格示例数据已经被更改';","initialize":"Wb.apply(app, {\n  /**\n   * tree1配置拖放事件，允许grid数据拖动到tree以调整人员所属部门。\n   */\n  treeViewConfig: {\n    plugins: {\n      ptype: 'treeviewdragdrop',\n      ddGroup: 'dept',\n      enableDrag: false\n    },\n    listeners: {\n      beforedrop: function(node, data, om, dp, dh) {\n        dh.wait = true;\n        dh.cancelDrop();\n        Wb.request({\n          url: 'm?xwl=examples/employee/edit/change-dept',\n          params: {\n            newDeptId: om.data.DEPT_ID,\n            recs: Wb.getData(data.records)\n          },\n          success: function() {\n            //停止删除store记录时触发的app.setModified方法\n            app.suspendSetModified = true;\n            Wb.remove(app.grid1);\n            app.suspendSetModified = false;\n          }\n        });\n      },\n      nodedragover: function(node, dp, data) {\n        return dp == 'append' && app.selectDeptNode != node;\n      }\n    }\n  },\n  /**\n   * 加载指定部门的人员数据。\n   */\n  loadData: function() {\n    app.grid1.store.load({\n      params: app.selDept.data\n    });\n  },\n  /**\n   * 在Viewport1渲染完成后执行的方法。\n   */\n  afterRender: function() {\n    app.navKey = new Ext.KeyNav({\n      viewport: app.viewport1,\n      E: {\n        ctrl: true,\n        fn: function() {\n          app.newBtn.fireEvent('click');\n        }\n      },\n      S: {\n        ctrl: true,\n        fn: function() {\n          app.saveBtn.fireEvent('click');\n        }\n      }\n    });\n    app.unModified();\n  },\n  /**\n   * 设置为数据已经修改的状态。\n   */\n  setModified: function() {\n    if (app.suspendSetModified)\n      return;\n    app.isModified = true;\n    Wb.setDisabled([app.searchCombo, app.resetSearchBtn, app.deptTree.tree1, app.grid1.down('toolbar')], true);\n    Wb.setDisabled([app.saveBtn, app.rejectBtn], false);\n  },\n  /**\n   * 设置为数据未修改状态。\n   */\n  unModified: function() {\n    app.isModified = false;\n    Wb.setDisabled([app.searchCombo, app.resetSearchBtn, app.deptTree.tree1, app.grid1.down('toolbar')], false);\n    Wb.setDisabled([app.saveBtn, app.rejectBtn], true);\n  }\n});"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"app.afterRender();"},"children":[{"configs":{"region":"north","itemId":"toolbar1"},"children":[{"configs":{"text":"添加","itemId":"newBtn","iconCls":"record_add_icon","tooltip":"添加新的记录 (Ctrl+E)"},"events":{"click":"if (!app.selDept) {\n  Wb.warn('部门未选择。');\n  return;\n}\nWb.addEdit(app.grid1, {\n  DEPT_ID: app.selDept.data.DEPT_ID\n});"},"children":[],"type":"item","expanded":false},{"configs":{"text":"删除","itemId":"delBtn","iconCls":"record_delete_icon","tooltip":"删除选择的记录"},"events":{"click":"Wb.remove(app.grid1);"},"children":[],"type":"item","expanded":false},{"configs":{"text":"-","itemId":"item1"},"children":[],"type":"item","expanded":false},{"configs":{"text":"保存","itemId":"saveBtn","iconCls":"save_icon","tooltip":"保存所有的更改 (Ctrl+S)"},"events":{"click":"if (!Wb.verifyGrid(app.grid1))\n  return;\nWb.sync({\n  grid: app.grid1,\n  url: 'm?xwl=examples/employee/edit/save',\n  message: '正在保存中...',\n  success: function(resp) {\n    Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n    app.unModified();\n  },\n  failure: function(resp) {\n    //可以根据后台返回的错误重置错误信息\n    if (resp.responseText.indexOf('WB_EMPLOYEE_EMPLOYEE_CODE') != -1) {\n      Wb.error('员工编号重复。');\n    }\n  }\n});"},"children":[],"type":"item","expanded":false},{"configs":{"text":"放弃","itemId":"rejectBtn","iconCls":"table_delete_icon","tooltip":"放弃自上次保存以来所有的更改"},"events":{"click":"Wb.confirm('确定要放弃对表格的所有更改吗？', function() {\n  app.grid1.store.rejectChanges();\n  app.unModified();\n});"},"children":[],"type":"item","expanded":false},{"configs":{"text":"-","itemId":"item2"},"children":[],"type":"item","expanded":false},{"configs":{"enterKeyTriggerClick":"true","displayField":"REAL_NAME","triggerCls":"x-form-search-trigger","width":"150","emptyText":"姓名","itemId":"searchCombo","onTriggerClick":"this.collapse();\napp.grid1.store.load({\n  out: app.toolbar1 //toolbar1内的所有控件值作为参数列表\n});"},"events":{"select":"Ext.callback(combo.onTriggerClick, combo);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=examples/employee/edit/search"},"children":[],"type":"store","expanded":false}],"type":"combo","expanded":true},{"configs":{"text":"重置搜索","itemId":"resetSearchBtn","iconCls":"undo_icon","tooltip":"重置搜索结果"},"events":{"click":"app.loadData();"},"children":[],"type":"item","expanded":false}],"type":"toolbar","expanded":true},{"configs":{"file":"m?xwl=examples/employee/public/dept-tree","itemId":"deptTree"},"children":[],"type":"xwl","expanded":false},{"configs":{"region":"center","multiSelect":"true","submitSelect":"true","itemId":"grid1","editable":"true","viewConfig":"{\n  plugins: {\n    ptype: 'gridviewdragdrop',\n    ddGroup: 'dept',\n    enableDrop: false\n  }\n}"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"sorters":"'EMPLOYEE_CODE'","remoteSort":"true","itemId":"store","url":"m?xwl=examples/employee/dict-edit/select"},"events":{"load":"if (!app.grid1.columnConfiged) {\n  Wb.getColumn(store, 'COMPANY_NAME').editor = app.grid1.companyEditor;\n  Wb.bindChange(app.grid1, app.setModified);\n  app.grid1.columnConfiged = true;\n}"},"children":[],"type":"store","expanded":false},{"configs":{"displayField":"COMPANY_NAME","listConfig":"{\n  minWidth: 200\n}","bindField":"COMPANY_ID","itemId":"companyEditor"},"children":[{"configs":{"itemId":"store","url":"m?xwl=examples/employee/edit/company-list"},"children":[],"type":"store","expanded":false}],"type":"combo","expanded":true}],"type":"grid","expanded":true}],"type":"viewport","expanded":true}],"type":"module","expanded":true}],"iconCls":""}