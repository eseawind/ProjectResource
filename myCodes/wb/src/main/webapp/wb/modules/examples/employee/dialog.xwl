{"title":"对话框","inframe":false,"hidden":false,"roles":{"demo":1},"pageLink":"","children":[{"configs":{"itemId":"module"},"events":{"initialize":"Wb.apply(app, {\n  /**\n   * tree1配置拖放事件，允许grid数据拖动到tree以调整人员所属部门。\n   */\n  treeViewConfig: {\n    plugins: {\n      ptype: 'treeviewdragdrop',\n      ddGroup: 'dept',\n      enableDrag: false\n    },\n    listeners: {\n      beforedrop: function(node, data, om, dp, dh) {\n        dh.wait = true;\n        dh.cancelDrop();\n        Wb.request({\n          url: 'm?xwl=examples/employee/edit/change-dept',\n          params: {\n            newDeptId: om.data.DEPT_ID,\n            recs: Wb.getData(data.records)\n          },\n          success: function() {\n            Wb.remove(app.grid1);\n          }\n        });\n      },\n      nodedragover: function(node, dp, data) {\n        return dp == 'append' && app.selectDeptNode != node;\n      }\n    }\n  },\n  /**\n   * 加载指定部门的人员数据。\n   */\n  loadData: function() {\n    app.grid1.store.load({\n      params: app.selDept.data\n    });\n  }\n});"},"children":[{"configs":{"height":"440","layout":"absolute","width":"576","focusControl":"EMPLOYEE_CODE","itemId":"editWin","editWin":"true"},"events":{"ok":"var values = Wb.getValue(app.editWin);\nif (app.isEdit) {\n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/employee/dialog/update',\n    params: Wb.applyIf(values, Wb.getData(app.selRec, true)), //合并窗口和记录数据作为参数，后者为默认值\n    success: function() {\n      //把窗口数据更新到选择记录中\n      Wb.update(app.selRec, values);\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      app.editWin.close();\n    }\n  });\n} else {\n  //点击添加按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/employee/dialog/insert',\n    out: app.editWin,\n    params: {\n      DEPT_ID: app.selDept.data.DEPT_ID\n    },\n    success: function(resp) {\n      //把服务器返回的数据合并窗口数据（公司名称等数据）添加到表格中\n      Wb.add(app.grid1, Wb.apply(Wb.decode(resp.responseText), values));\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      app.editWin.close();\n    }\n  });\n}"},"children":[{"configs":{"height":"22","allowBlank":"false","width":"264","labelAlign":"right","itemId":"EMPLOYEE_CODE","fieldLabel":"*员工编号","y":"24","x":"0"},"children":[],"type":"text","expanded":false},{"configs":{"height":"22","allowBlank":"false","width":"264","labelAlign":"right","itemId":"REAL_NAME","fieldLabel":"*姓名","y":"24","x":"272"},"children":[],"type":"text","expanded":false},{"configs":{"height":"22","allowBlank":"false","width":"264","labelAlign":"right","itemId":"BIRTH_DATE","fieldLabel":"*出生日期","y":"56","x":"0"},"children":[],"type":"date","expanded":false},{"configs":{"keyName":"sex","height":"22","allowBlank":"false","width":"264","labelAlign":"right","itemId":"SEX","fieldLabel":"*性别","y":"56","x":"272"},"children":[],"type":"combo","expanded":false},{"configs":{"keyName":"nation","height":"22","width":"264","labelAlign":"right","itemId":"NATION","fieldLabel":"民族","y":"88","x":"0"},"children":[],"type":"combo","expanded":false},{"configs":{"height":"22","width":"264","vtype":"email","labelAlign":"right","itemId":"EMAIL","fieldLabel":"电子邮件","y":"88","x":"272"},"children":[],"type":"text","expanded":false},{"configs":{"height":"22","minValue":"0","width":"264","labelAlign":"right","itemId":"VACATION_HOURS","fieldLabel":"休假时长","y":"120","x":"0"},"children":[],"type":"number","expanded":false},{"configs":{"height":"22","displayField":"COMPANY_NAME","width":"264","bindField":"COMPANY_ID","labelAlign":"right","itemId":"COMPANY_NAME","fieldLabel":"负责公司","y":"120","x":"272"},"children":[{"configs":{"itemId":"store","url":"m?xwl=examples/employee/edit/company-list"},"children":[],"type":"store","expanded":false}],"type":"combo","expanded":true},{"configs":{"title":"备注：","height":"208","width":"504","layout":"fit","itemId":"fieldset1","padding":"8","y":"152","x":"32"},"children":[{"configs":{"itemId":"REMARK"},"children":[],"type":"textarea","expanded":false}],"type":"fieldset","expanded":true}],"type":"window","expanded":true},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"app.navKey = new Ext.KeyNav({\n  viewport: app.viewport1,\n  E: {\n    ctrl: true,\n    fn: function() {\n      app.newBtn.fireEvent('click');\n    }\n  }\n});"},"children":[{"configs":{"region":"north","itemId":"toolbar1"},"children":[{"configs":{"text":"添加","itemId":"newBtn","iconCls":"record_add_icon","tooltip":"添加新的记录 (Ctrl+E)"},"events":{"click":"if (!app.selDept) {\n  Wb.warn('部门未选择。');\n  return;\n}\napp.editWin.setTitle('添加 - ' + app.selDept.data.DEPT_NAME);\napp.editWin.setIconCls('record_add_icon');\napp.editWin.show();\napp.isEdit = false; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性"},"children":[],"type":"item","expanded":false},{"configs":{"text":"修改","itemId":"editBtn","iconCls":"record_edit_icon","tooltip":"修改选择的记录"},"events":{"click":"var sels = app.grid1.getSelection();\nif (sels.length != 1) {\n  Wb.warn('请选择 1 条需要修改的记录。');\n  return;\n}\napp.selRec = sels[0];\napp.editWin.setTitle('修改 - ' + app.selRec.data.REAL_NAME);\napp.editWin.setIconCls('record_edit_icon');\nWb.setValue(app.editWin, app.selRec.data);\napp.editWin.show();\napp.isEdit = true; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性"},"children":[],"type":"item","expanded":false},{"configs":{"text":"删除","itemId":"delBtn","iconCls":"record_delete_icon","tooltip":"删除选择的记录"},"events":{"click":"var sels = app.grid1.getSelection();\nWb.confirmDo(sels, function() {\n  Wb.request({\n    url: 'm?xwl=examples/employee/dialog/delete',\n    params: {\n      destroy: Wb.getData(sels, true)\n    },\n    success: function() {\n      Wb.remove(app.grid1, sels);\n    }\n  });\n}, 'REAL_NAME');"},"children":[],"type":"item","expanded":false},{"configs":{"text":"-","itemId":"item1"},"children":[],"type":"item","expanded":false},{"configs":{"displayField":"REAL_NAME","enterKeyTriggerClick":"true","triggerCls":"x-form-search-trigger","width":"130","emptyText":"姓名","itemId":"searchCombo","onTriggerClick":"this.collapse();\napp.grid1.store.load({\n  out: app.toolbar1 //toolbar1内的所有控件值作为参数列表\n});"},"events":{"select":"Ext.callback(combo.onTriggerClick, combo);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=examples/employee/edit/search"},"children":[],"type":"store","expanded":false}],"type":"combo","expanded":true},{"configs":{"text":"重置搜索","itemId":"resetSearchBtn","iconCls":"undo_icon","tooltip":"重置搜索结果"},"events":{"click":"app.loadData();"},"children":[],"type":"item","expanded":false}],"type":"toolbar","expanded":true},{"configs":{"file":"m?xwl=examples/employee/public/dept-tree","itemId":"deptTree"},"children":[],"type":"xwl","expanded":false},{"configs":{"region":"center","multiSelect":"true","itemId":"grid1","viewConfig":"{\n  plugins: {\n    ptype: 'gridviewdragdrop',\n    ddGroup: 'dept',\n    enableDrop: false\n  }\n}"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"sorters":"'EMPLOYEE_CODE'","itemId":"store","remoteSort":"true","url":"m?xwl=examples/employee/edit/select"},"children":[],"type":"store","expanded":false},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","itemId":"numCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"员工编号","width":"80","dataIndex":"EMPLOYEE_CODE","itemId":"employeeCodeCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"姓名","width":"150","dataIndex":"REAL_NAME","itemId":"realNameCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"出生日期","width":"100","dataIndex":"BIRTH_DATE","itemId":"birthDateCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"性别","keyName":"sex","width":"50","dataIndex":"SEX","itemId":"sexCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"民族","keyName":"nation","width":"60","dataIndex":"NATION","itemId":"nationCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"电子邮件","width":"150","dataIndex":"EMAIL","itemId":"emailCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"休假时长","width":"70","align":"right","dataIndex":"VACATION_HOURS","format":"#,##0","itemId":"vacationHoursCol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"负责公司","width":"130","dataIndex":"COMPANY_NAME","itemId":"companyNAMECol"},"children":[],"type":"column","expanded":false},{"configs":{"text":"备注","dataIndex":"REMARK","itemId":"remarkCol","flex":"1"},"children":[],"type":"column","expanded":false}],"type":"array","expanded":true}],"type":"grid","expanded":true}],"type":"viewport","expanded":true}],"type":"module","expanded":true}],"iconCls":""}